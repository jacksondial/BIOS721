---
title: "Project1_JacksonDial"
author: "Jackson Dial"
date: "9/3/2021"
output: word_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Load Libraries

```{r}
#setwd("C:/Users/jacks/OneDrive/Desktop/DUKE_FALL2021/721/BIOS721")
#libraries
library(here)
library(readr)
library(tidyverse)

#Don't forget to do Lintr and Styler

```


## Read Data

```{r}
#setwd("C:/Users/jacks/OneDrive/Desktop/DUKE_FALL2021/721/BIOS721")
#use here() function for better reproducibility
patient <- read_csv(here("Data", "Patient Level Data_proj1.csv"))
encounter <- read_csv(here("Data", "Encounter Level Data_proj1.csv"))

#join the patient level and encounter level data frames into one on MRN (ID)
dat <- encounter %>%
  left_join(patient, by = "MRN")

```

### Data Cleaning

```{r}
#check for any wrong values in the categorical variables
table(dat$enc_type, dat$race) #just using table because it does 2 at a time and is less code
table(dat$financialclass, dat$ethnicity)
table(dat$hypertension, dat$CHF)
levels(as.factor(dat$diabetes))
#they all look good so no imputation/removal must occur

summary(dat)

#replace impossible values with NA
dat["BMI.r"][which(dat$BMI.r > 70),] <- NA
dat["BMI.r"][which(dat$BMI.r < 0),] <- NA

# determine if 53 is an outlier for WBC

ggplot(dat, aes(x = WBC))+
  geom_histogram()

ggplot(dat, aes(y = WBC))+
  geom_boxplot()

dat %>% select(WBC) %>% filter(WBC > 30)
#it does appear that there are two possible outliers, at 38.0 & 53.6
#I am going to replace them with NA values for now but may change it later

dat["WBC"][which(dat$WBC > 30),] <- NA




```




### Data Explanation

The data included in this analysis is comprised of two original data sets, one on patient data and one on encounter data. Patient data can be understood as information regarding a specific person, containing demographic information. This original dataset has 50 observations (patients) and 8 variables. The encounter dataset is a record of every time any of the 50 patients had an interaction with the Healthcare system being considered, and contains information regarding that visit such as reason for visit, date, and measurements regarding their current health status. This dataset contains 550 observations and 7 variables. A more precise description of each variable will be given below.

These two described data sets were joined together on the "MRN" column, which is an acronym meaning Medical Record Number. The dimension of this data frame is 550 observations with 14 variables. 


```{r}
sum(is.na(dat)) #211

#it looks like when there is a hospital encounter the distress score and wbc are NA
#values, let's take a better look:

dat %>% filter(enc_type == "Hospital Encounter") %>% nrow() #53
sum(is.na(dat %>% filter(enc_type == "Hospital Encounter"))) #158 = 53*3 - 1 (there is one that is -999)
#
#there is also just a bunch of random BMI.r and WBC NA values
```

### Determine what to do with NA values

```{r}
dat %>% filter(BMI.r < 70 & BMI.r > 0) %>% 
  ggplot(aes(x = BMI.r))+
  geom_histogram()+
  geom_vline(xintercept = mean(dat$BMI.r, na.rm = T), col = "red")+
  geom_vline(xintercept = median(dat$BMI.r, na.rm = T), col = "dodgerblue")




```






